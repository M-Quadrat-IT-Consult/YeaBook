from __future__ import annotations

from typing import Dict, Mapping, Optional

DEFAULT_LANGUAGE = "en"

_TRANSLATIONS: Dict[str, Dict[str, Mapping[str, str]]] = {
    "en": {
        "label": "English",
        "ui": {
            "app_title": "Yealink Phonebook",
            "xml_preview_label": "View current XML",
            "form_create_title": "Add new contact",
            "form_edit_title": "Edit contact",
            "form_name_label": "Name *",
            "form_name_placeholder": "John Smith",
            "form_group_label": "Group *",
            "form_group_placeholder": "Staff",
            "group_custom_option": "Other (custom)…",
            "group_custom_label": "Custom group name",
            "group_custom_hint": "Enter a new group name if it is not listed.",
            "form_telephone_label": "Office phone",
            "form_telephone_placeholder": "123456789",
            "form_mobile_label": "Mobile phone",
            "form_mobile_placeholder": "987654321",
            "form_other_label": "Other number",
            "form_other_placeholder": "555444333",
            "form_submit": "Add contact",
            "form_submit_edit": "Save changes",
            "form_cancel_edit": "Cancel",
            "phone_hint": "Allowed characters: + and digits.",
            "table_name_header": "Name",
            "table_group_header": "Group",
            "table_telephone_header": "Phone",
            "table_mobile_header": "Mobile",
            "table_other_header": "Other",
            "table_actions_header": "Actions",
            "delete_button_label": "Delete",
            "edit_button_label": "Edit",
            "help_toggle_label": "Remote phonebook help",
            "github_label": "Project GitHub repository",
            "docker_label": "Docker image on Docker Hub",
            "status_label": "Latest release status",
            "status_current": "Up to date",
            "status_new_release": "New release available",
            "status_unreachable": "Status temporarily unavailable",
            "status_unknown": "Status unknown",
            "version_prefix": "Version",
            "help_heading": "Configure Yealink remote phonebook",
            "help_step1": "Open the Yealink web interface and sign in as administrator.",
            "help_step2": "Navigate to Directory → Remote Phone Book (or Directory Settings on some models).",
            "help_step3": "Add a new remote phonebook entry and set the URL to:",
            "help_step4": "Save the configuration and assign the phonebook to the desired line or soft key.",
            "help_tip": "Yealink devices will refresh the XML when the directory is opened. For larger fleets, schedule periodic refreshes in the phone’s settings.",
            "no_contacts_message": "The phonebook is empty. Use the form above to add the first entry.",
            "language_label": "Language",
            "footer_prefix": "M Quadrat IT Consult · Ahrensburg · Marcin Litwiński ·",
        },
        "messages": {
            "contact_name_required": "Contact name is required.",
            "contact_added": "Contact {name} added.",
            "contact_removed": "Contact removed.",
            "contact_updated": "Contact {name} updated.",
            "contact_missing": "The selected contact could not be found.",
            "invalid_phone": "Invalid phone number in fields: {fields}. Use only + and digits.",
            "editing_contact": "Editing contact: {name}",
        },
    },
    "de": {
        "label": "Deutsch",
        "ui": {
            "app_title": "Yealink Telefonbuch",
            "xml_preview_label": "Aktuelles XML anzeigen",
            "form_create_title": "Neuen Kontakt hinzufügen",
            "form_edit_title": "Kontakt bearbeiten",
            "form_name_label": "Name *",
            "form_name_placeholder": "Max Mustermann",
            "form_group_label": "Gruppe *",
            "form_group_placeholder": "Mitarbeiter",
            "group_custom_option": "Andere (eigene)…",
            "group_custom_label": "Eigener Gruppenname",
            "group_custom_hint": "Geben Sie einen neuen Gruppennamen ein, wenn er nicht in der Liste steht.",
            "form_telephone_label": "Bürotelefon",
            "form_telephone_placeholder": "123456789",
            "form_mobile_label": "Mobiltelefon",
            "form_mobile_placeholder": "987654321",
            "form_other_label": "Weitere Nummer",
            "form_other_placeholder": "555444333",
            "form_submit": "Kontakt hinzufügen",
            "form_submit_edit": "Änderungen speichern",
            "form_cancel_edit": "Abbrechen",
            "phone_hint": "Erlaubte Zeichen: + und Ziffern.",
            "table_name_header": "Name",
            "table_group_header": "Gruppe",
            "table_telephone_header": "Telefon",
            "table_mobile_header": "Mobil",
            "table_other_header": "Weitere",
            "table_actions_header": "Aktionen",
            "delete_button_label": "Löschen",
            "edit_button_label": "Bearbeiten",
            "help_toggle_label": "Hilfe zur Remote-Telefonliste",
            "github_label": "GitHub-Repository des Projekts",
            "docker_label": "Docker-Image auf Docker Hub",
            "status_label": "Release-Status",
            "status_current": "Aktuell",
            "status_new_release": "Neue Version verfügbar",
            "status_unreachable": "Status vorübergehend nicht verfügbar",
            "status_unknown": "Status unbekannt",
            "version_prefix": "Version",
            "help_heading": "Yealink-Remote-Telefonbuch konfigurieren",
            "help_step1": "Öffnen Sie die Yealink-Weboberfläche und melden Sie sich als Administrator an.",
            "help_step2": "Navigieren Sie zu Verzeichnis → Remote Phone Book (oder Verzeichniseinstellungen je nach Modell).",
            "help_step3": "Fügen Sie einen neuen Remote-Eintrag hinzu und setzen Sie die URL auf:",
            "help_step4": "Speichern Sie die Konfiguration und weisen Sie das Telefonbuch der gewünschten Leitung oder Taste zu.",
            "help_tip": "Yealink-Geräte laden die XML-Datei neu, sobald das Verzeichnis geöffnet wird. Für größere Installationen können Sie regelmäßige Aktualisierungen im Gerät planen.",
            "no_contacts_message": "Das Telefonbuch ist leer. Bitte fügen Sie oben den ersten Eintrag hinzu.",
            "language_label": "Sprache",
            "footer_prefix": "M Quadrat IT Consult · Ahrensburg · Marcin Litwiński ·",
        },
        "messages": {
            "contact_name_required": "Der Kontaktname ist erforderlich.",
            "contact_added": "Kontakt {name} hinzugefügt.",
            "contact_removed": "Kontakt entfernt.",
            "contact_updated": "Kontakt {name} aktualisiert.",
            "contact_missing": "Der ausgewählte Kontakt wurde nicht gefunden.",
            "invalid_phone": "Ungültige Telefonnummer in den Feldern: {fields}. Erlaubt sind nur + und Ziffern.",
            "editing_contact": "Kontakt wird bearbeitet: {name}",
        },
    },
    "pl": {
        "label": "Polski",
        "ui": {
            "app_title": "Książka telefoniczna Yealink",
            "xml_preview_label": "Zobacz bieżący XML",
            "form_create_title": "Dodaj nowy kontakt",
            "form_edit_title": "Edytuj kontakt",
            "form_name_label": "Nazwa *",
            "form_name_placeholder": "Jan Kowalski",
            "form_group_label": "Grupa *",
            "form_group_placeholder": "Pracownicy",
            "group_custom_option": "Inna (własna)…",
            "group_custom_label": "Własna nazwa grupy",
            "group_custom_hint": "Wpisz nową grupę, jeśli nie ma jej na liście.",
            "form_telephone_label": "Telefon biurowy",
            "form_telephone_placeholder": "123456789",
            "form_mobile_label": "Telefon komórkowy",
            "form_mobile_placeholder": "987654321",
            "form_other_label": "Inny numer",
            "form_other_placeholder": "555444333",
            "form_submit": "Dodaj kontakt",
            "form_submit_edit": "Zapisz zmiany",
            "form_cancel_edit": "Anuluj",
            "phone_hint": "Dozwolone znaki: + oraz cyfry.",
            "table_name_header": "Nazwa",
            "table_group_header": "Grupa",
            "table_telephone_header": "Telefon",
            "table_mobile_header": "Komórka",
            "table_other_header": "Inny",
            "table_actions_header": "Akcje",
            "delete_button_label": "Usuń",
            "edit_button_label": "Edytuj",
            "help_toggle_label": "Pomoc dotycząca zdalnej książki",
            "github_label": "Repozytorium GitHub projektu",
            "docker_label": "Obraz Dockera na Docker Hub",
            "status_label": "Status wydania",
            "status_current": "Aktualna wersja",
            "status_new_release": "Dostępna nowa wersja",
            "status_unreachable": "Status chwilowo niedostępny",
            "status_unknown": "Status nieznany",
            "version_prefix": "Wersja",
            "help_heading": "Konfiguracja zdalnej książki Yealink",
            "help_step1": "Otwórz panel WWW Yealink i zaloguj się jako administrator.",
            "help_step2": "Przejdź do Książka telefoniczna → Zdalna książka (lub Ustawienia katalogu w zależności od modelu).",
            "help_step3": "Dodaj nową pozycję i ustaw adres URL na:",
            "help_step4": "Zapisz konfigurację i przypisz książkę do wybranej linii lub klawisza funkcyjnego.",
            "help_tip": "Telefony Yealink odświeżają XML przy każdym otwarciu katalogu. Przy większej liczbie urządzeń można zaplanować automatyczne odświeżanie w ustawieniach telefonu.",
            "no_contacts_message": "Książka jest pusta. Dodaj pierwszy wpis w formularzu powyżej.",
            "language_label": "Język",
            "footer_prefix": "M Quadrat IT Consult · Ahrensburg · Marcin Litwiński ·",
        },
        "messages": {
            "contact_name_required": "Nazwa kontaktu jest wymagana.",
            "contact_added": "Dodano kontakt {name}.",
            "contact_removed": "Kontakt usunięty.",
            "contact_updated": "Zaktualizowano kontakt {name}.",
            "contact_missing": "Wybrany kontakt nie został znaleziony.",
            "invalid_phone": "Nieprawidłowy numer telefonu w polach: {fields}. Dozwolone są tylko + oraz cyfry.",
            "editing_contact": "Edycja kontaktu: {name}",
        },
    },
}


def resolve_language(code: Optional[str]) -> str:
    if code and code in _TRANSLATIONS:
        return code
    return DEFAULT_LANGUAGE


def get_translations(code: Optional[str]) -> Mapping[str, Mapping[str, str]]:
    language = resolve_language(code)
    return _TRANSLATIONS[language]


def get_ui_strings(code: Optional[str]) -> Mapping[str, str]:
    return get_translations(code)["ui"]


def get_message(code: Optional[str], key: str, **kwargs) -> str:
    template = get_translations(code)["messages"][key]
    return template.format(**kwargs)


def get_language_options() -> Mapping[str, str]:
    return {code: data["label"] for code, data in _TRANSLATIONS.items()}
